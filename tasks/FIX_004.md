# FIX_004: Subtask 'order' Property Issues

**Priority**: MEDIUM
**Estimated Time**: 30-60 minutes
**Files Affected**: 23 errors across 6 files

## Overview

Multiple files reference a non-existent `order` property on the `Subtask` type. This needs to be either added to the type definition or removed from usage.

## Errors to Fix

### 1. Test Files Using 'order' Property (8 errors)
**Files**:
- `src/components/TaskEditor/__tests__/SubtaskList.test.tsx:74, 94`
- `src/components/TaskEditor/SubtaskList.stories.tsx:70, 93, 112, 133`

```typescript
// ERROR: Object literal may only specify known properties, and 'order' does not exist in type 'Subtask'
{
  id: 'subtask-1',
  title: 'Test subtask',
  order: 0,  // ❌ This property doesn't exist
}
```

### 2. Story Files Using 'order' Property (12 errors)
**Files**:
- `src/components/TaskEditor/TaskEditor.stories.tsx:77, 98, 115, 276, 486, 505`

```typescript
// ERROR: Same issue in story definitions
const mockSubtask = {
  id: 'subtask-1',
  title: 'Complete initial research',
  order: 0,  // ❌ This property doesn't exist
}
```

### 3. Component Implementation Using 'order' (1 error)
**File**: `src/components/TaskEditor/SubtaskList.tsx:129`

```typescript
// ERROR: Property 'order' does not exist on type 'Subtask'
order: subtask.order,  // ❌ Accessing non-existent property
```

### 4. Component Form Data Type Mismatch (1 error)
**File**: `src/components/TaskEditor/SubtaskList.tsx:518`

```typescript
// ERROR: Type 'SubtaskFormData' is missing required properties
onSubtaskAdd(data);  // Missing: isDeleted, progress, checklist, taskId
```

### 5. Test Expectations Error (1 error)
**File**: `src/components/TaskEditor/__tests__/SubtaskList.test.tsx:417`

```typescript
// ERROR: Expected 1 arguments, but got 2
expect(completedSubtask).toHaveClass('line-through', 'text-muted-foreground');
```

## Solution Strategy

### Option A: Add 'order' Property to Subtask Type (Recommended)
If ordering is needed for subtasks, add it to the type:

```typescript
export interface Subtask {
  id: string;
  title: string;
  description: string;
  status: TaskStatus;
  priority: GoalPriority;
  order: number;  // ✅ Add this property
  // ... other existing properties
}
```

### Option B: Remove 'order' Usage (Alternative)
If ordering isn't needed, remove all references:

```typescript
// Remove 'order' from all mock data and usage
const mockSubtask = {
  id: 'subtask-1',
  title: 'Complete initial research',
  // order: 0,  // ❌ Remove this line
}
```

### Option C: Use Array Index for Ordering
Use array indices instead of explicit order property:

```typescript
// In components, use array index for ordering
subtasks.map((subtask, index) => ({
  ...subtask,
  displayOrder: index,
}))
```

## Implementation Steps

### If Adding 'order' Property (Recommended):
1. **Update Subtask interface** to include `order: number`
2. **Update default/mock data** to include order values
3. **Update form validation** to handle order field
4. **Test drag & drop reordering** functionality

### If Removing 'order' Property:
1. **Remove order from all mock data** in tests and stories
2. **Remove order usage** in SubtaskList component
3. **Update drag & drop logic** to use array indices
4. **Test that reordering still works**

## Files to Modify

- [ ] `src/types/Task.types.ts` - Update Subtask interface (if adding)
- [ ] `src/components/TaskEditor/__tests__/SubtaskList.test.tsx` - Fix mock data
- [ ] `src/components/TaskEditor/SubtaskList.stories.tsx` - Fix story data
- [ ] `src/components/TaskEditor/TaskEditor.stories.tsx` - Fix story data
- [ ] `src/components/TaskEditor/SubtaskList.tsx` - Fix implementation
- [ ] Fix test expectation with multiple class names

## Specific Fixes Needed

### 1. Fix toHaveClass Test
```typescript
// Before
expect(completedSubtask).toHaveClass('line-through', 'text-muted-foreground');

// After
expect(completedSubtask).toHaveClass('line-through');
expect(completedSubtask).toHaveClass('text-muted-foreground');
// OR
expect(completedSubtask).toHaveClass('line-through text-muted-foreground');
```

### 2. Fix SubtaskFormData Type
```typescript
// Update the onSubtaskAdd call to provide complete Subtask object
const newSubtask: Omit<Subtask, 'id' | 'createdAt' | 'updatedAt'> = {
  ...data,
  isDeleted: false,
  progress: 0,
  checklist: [],
  taskId: props.taskId,
  order: subtasks.length, // if keeping order
};
onSubtaskAdd(newSubtask);
```

## Testing Checklist

- [ ] All test files compile without type errors
- [ ] All story files load without errors in Storybook
- [ ] Subtask creation works correctly
- [ ] Drag and drop reordering works (if using order)
- [ ] SubtaskList component renders properly
- [ ] Mock data matches actual Subtask interface

## Quick Decision Required

**Choose one approach:**
- ✅ **Add `order: number` to Subtask interface** (if reordering is important)
- ❌ **Remove all `order` references** (if reordering not needed)

## Dependencies

- No blocking dependencies
- Independent fix that can be done in parallel